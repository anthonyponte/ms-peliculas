apiVersion: v1
kind: ConfigMap
metadata:
  name: oracle-db-configmap
data:
  xepdb1.sql: |-
    SELECT SYS_CONTEXT('USERENV', 'CON_NAME') AS CURRENT_CONTAINER FROM DUAL;
    ALTER SESSION SET CONTAINER = XEPDB1;

    CREATE USER dkuser IDENTIFIED BY dkpassword;
    GRANT CONNECT, RESOURCE TO dkuser;
    ALTER USER dkuser QUOTA UNLIMITED ON users;

    CREATE TABLE dkuser.generos (
        id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        descripcion VARCHAR2(255) NOT NULL
    );

    CREATE TABLE dkuser.peliculas (
        id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        titulo VARCHAR2(255) NOT NULL,
        director VARCHAR2(255) NOT NULL,
        duracion NUMBER NOT NULL,
        fecha_estreno DATE NOT NULL,
        favorito NUMBER(1) DEFAULT 0 NOT NULL,
        id_genero NUMBER NOT NULL
    );

    ALTER TABLE dkuser.peliculas
    ADD CONSTRAINT fk_peliculas_generos
    FOREIGN KEY (id_genero)
    REFERENCES dkuser.generos(id);
